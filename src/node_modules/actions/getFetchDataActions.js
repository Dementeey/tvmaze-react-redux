import store from "store";
import setDataActions from "actions/setDataActions";
import setDataParsedActions from "actions/setDataParsedActions";
import {parseResponseInNewArray} from "../myHelpers";
import setTrueStatusSuccessActions from "actions/setTrueStatusSuccessActions";
import setTrueStatusPendingActions from "actions/setTrueStatusPendingActions";
import setTrueStatusRejectActions from "actions/setTrueStatusRejectActions";


export default (str) => {
  return dispatch => {
    fetch(`http://api.tvmaze.com/search/shows?q=${str}`)
      .then(r => r.json())
      .then(r => {
        store.dispatch(setTrueStatusRejectActions());
        if (!Object.keys(r).length) return;

        dispatch(setDataActions(r));
        dispatch(setDataParsedActions(parseResponseInNewArray(r)));
        dispatch(setTrueStatusSuccessActions());
      })
      .catch(() => dispatch(setTrueStatusPendingActions()));
  }
};
